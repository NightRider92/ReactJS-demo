{"ast":null,"code":"/* Copyright (c) 2012-2014 LevelUP contributors\n * See list at <https://github.com/rvagg/node-levelup#contributing>\n * MIT License\n * <https://github.com/rvagg/node-levelup/blob/master/LICENSE.md>\n */\n\nvar Stream = require('stream').Stream,\n  inherits = require('util').inherits,\n  extend = require('xtend'),\n  bl = require('bl'),\n  setImmediate = global.setImmediate || process.nextTick,\n  getOptions = require('./util').getOptions,\n  defaultOptions = {\n    type: 'put'\n  };\nfunction WriteStream(options, db) {\n  if (!(this instanceof WriteStream)) return new WriteStream(options, db);\n  Stream.call(this);\n  this._options = extend(defaultOptions, getOptions(db, options));\n  this._db = db;\n  this._buffer = [];\n  this._status = 'init';\n  this._end = false;\n  this.writable = true;\n  this.readable = false;\n  var self = this,\n    ready = function () {\n      if (!self.writable) return;\n      self._status = 'ready';\n      self.emit('ready');\n      self._process();\n    };\n  if (db.isOpen()) setImmediate(ready);else db.once('ready', ready);\n}\ninherits(WriteStream, Stream);\nWriteStream.prototype.write = function (data) {\n  if (!this.writable) return false;\n  this._buffer.push(data);\n  if (this._status != 'init') this._processDelayed();\n  if (this._options.maxBufferLength && this._buffer.length > this._options.maxBufferLength) {\n    this._writeBlock = true;\n    return false;\n  }\n  return true;\n};\nWriteStream.prototype.end = function (data) {\n  var self = this;\n  if (data) this.write(data);\n  setImmediate(function () {\n    self._end = true;\n    self._process();\n  });\n};\nWriteStream.prototype.destroy = function () {\n  this.writable = false;\n  this.end();\n};\nWriteStream.prototype.destroySoon = function () {\n  this.end();\n};\nWriteStream.prototype.add = function (entry) {\n  if (!entry.props) return;\n  if (entry.props.Directory) entry.pipe(this._db.writeStream(this._options));else if (entry.props.File || entry.File || entry.type == 'File') this._write(entry);\n  return true;\n};\nWriteStream.prototype._processDelayed = function () {\n  var self = this;\n  setImmediate(function () {\n    self._process();\n  });\n};\nWriteStream.prototype._process = function () {\n  var buffer,\n    self = this,\n    cb = function (err) {\n      if (!self.writable) return;\n      if (self._status != 'closed') self._status = 'ready';\n      if (err) {\n        self.writable = false;\n        return self.emit('error', err);\n      }\n      self._process();\n    };\n  if (self._status != 'ready' && self.writable) {\n    if (self._buffer.length && self._status != 'closed') self._processDelayed();\n    return;\n  }\n  if (self._buffer.length && self.writable) {\n    self._status = 'writing';\n    buffer = self._buffer;\n    self._buffer = [];\n    self._db.batch(buffer.map(function (d) {\n      return {\n        type: d.type || self._options.type,\n        key: d.key,\n        value: d.value,\n        keyEncoding: d.keyEncoding || self._options.keyEncoding,\n        valueEncoding: d.valueEncoding || d.encoding || self._options.valueEncoding\n      };\n    }), cb);\n    if (self._writeBlock) {\n      self._writeBlock = false;\n      self.emit('drain');\n    }\n\n    // don't allow close until callback has returned\n    return;\n  }\n  if (self._end && self._status != 'closed') {\n    self._status = 'closed';\n    self.writable = false;\n    self.emit('close');\n  }\n};\nWriteStream.prototype._write = function (entry) {\n  var key = entry.path || entry.props.path,\n    self = this;\n  if (!key) return;\n  entry.pipe(bl(function (err, data) {\n    if (err) {\n      self.writable = false;\n      return self.emit('error', err);\n    }\n    if (self._options.fstreamRoot && key.indexOf(self._options.fstreamRoot) > -1) key = key.substr(self._options.fstreamRoot.length + 1);\n    self.write({\n      key: key,\n      value: data.slice(0)\n    });\n  }));\n};\nWriteStream.prototype.toString = function () {\n  return 'LevelUP.WriteStream';\n};\nmodule.exports = WriteStream;","map":{"version":3,"names":["Stream","require","inherits","extend","bl","setImmediate","global","process","nextTick","getOptions","defaultOptions","type","WriteStream","options","db","call","_options","_db","_buffer","_status","_end","writable","readable","self","ready","emit","_process","isOpen","once","prototype","write","data","push","_processDelayed","maxBufferLength","length","_writeBlock","end","destroy","destroySoon","add","entry","props","Directory","pipe","writeStream","File","_write","buffer","cb","err","batch","map","d","key","value","keyEncoding","valueEncoding","encoding","path","fstreamRoot","indexOf","substr","slice","toString","module","exports"],"sources":["C:/Users/Moran/Documents/react-projects/react-demo/node_modules/levelup/lib/write-stream.js"],"sourcesContent":["/* Copyright (c) 2012-2014 LevelUP contributors\n * See list at <https://github.com/rvagg/node-levelup#contributing>\n * MIT License\n * <https://github.com/rvagg/node-levelup/blob/master/LICENSE.md>\n */\n\nvar Stream       = require('stream').Stream\n  , inherits     = require('util').inherits\n  , extend       = require('xtend')\n  , bl           = require('bl')\n\n  , setImmediate = global.setImmediate || process.nextTick\n\n  , getOptions   = require('./util').getOptions\n\n  , defaultOptions = { type: 'put' }\n\nfunction WriteStream (options, db) {\n  if (!(this instanceof WriteStream))\n    return new WriteStream(options, db)\n\n  Stream.call(this)\n  this._options = extend(defaultOptions, getOptions(db, options))\n  this._db      = db\n  this._buffer  = []\n  this._status  = 'init'\n  this._end     = false\n  this.writable = true\n  this.readable = false\n\n  var self = this\n    , ready = function () {\n        if (!self.writable)\n          return\n        self._status = 'ready'\n        self.emit('ready')\n        self._process()\n      }\n\n  if (db.isOpen())\n    setImmediate(ready)\n  else\n    db.once('ready', ready)\n}\n\ninherits(WriteStream, Stream)\n\nWriteStream.prototype.write = function (data) {\n  if (!this.writable)\n    return false\n  this._buffer.push(data)\n  if (this._status != 'init')\n    this._processDelayed()\n  if (this._options.maxBufferLength &&\n      this._buffer.length > this._options.maxBufferLength) {\n    this._writeBlock = true\n    return false\n  }\n  return true\n}\n\nWriteStream.prototype.end = function (data) {\n  var self = this\n  if (data)\n    this.write(data)\n  setImmediate(function () {\n    self._end = true\n    self._process()\n  })\n}\n\nWriteStream.prototype.destroy = function () {\n  this.writable = false\n  this.end()\n}\n\nWriteStream.prototype.destroySoon = function () {\n  this.end()\n}\n\nWriteStream.prototype.add = function (entry) {\n  if (!entry.props)\n    return\n  if (entry.props.Directory)\n    entry.pipe(this._db.writeStream(this._options))\n  else if (entry.props.File || entry.File || entry.type == 'File')\n    this._write(entry)\n  return true\n}\n\nWriteStream.prototype._processDelayed = function () {\n  var self = this\n  setImmediate(function () {\n    self._process()\n  })\n}\n\nWriteStream.prototype._process = function () {\n  var buffer\n    , self = this\n\n    , cb = function (err) {\n        if (!self.writable)\n          return\n        if (self._status != 'closed')\n          self._status = 'ready'\n        if (err) {\n          self.writable = false\n          return self.emit('error', err)\n        }\n        self._process()\n      }\n\n  if (self._status != 'ready' && self.writable) {\n    if (self._buffer.length && self._status != 'closed')\n      self._processDelayed()\n    return\n  }\n\n  if (self._buffer.length && self.writable) {\n    self._status = 'writing'\n    buffer       = self._buffer\n    self._buffer = []\n\n    self._db.batch(buffer.map(function (d) {\n      return {\n          type          : d.type || self._options.type\n        , key           : d.key\n        , value         : d.value\n        , keyEncoding   : d.keyEncoding || self._options.keyEncoding\n        , valueEncoding : d.valueEncoding\n            || d.encoding\n            || self._options.valueEncoding\n      }\n    }), cb)\n\n    if (self._writeBlock) {\n      self._writeBlock = false\n      self.emit('drain')\n    }\n\n    // don't allow close until callback has returned\n    return\n  }\n\n  if (self._end && self._status != 'closed') {\n    self._status  = 'closed'\n    self.writable = false\n    self.emit('close')\n  }\n}\n\nWriteStream.prototype._write = function (entry) {\n  var key = entry.path || entry.props.path\n    , self = this\n\n  if (!key)\n    return\n\n  entry.pipe(bl(function (err, data) {\n    if (err) {\n      self.writable = false\n      return self.emit('error', err)\n    }\n\n    if (self._options.fstreamRoot &&\n        key.indexOf(self._options.fstreamRoot) > -1)\n      key = key.substr(self._options.fstreamRoot.length + 1)\n\n    self.write({ key: key, value: data.slice(0) })\n  }))\n}\n\nWriteStream.prototype.toString = function () {\n  return 'LevelUP.WriteStream'\n}\n\nmodule.exports = WriteStream\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}