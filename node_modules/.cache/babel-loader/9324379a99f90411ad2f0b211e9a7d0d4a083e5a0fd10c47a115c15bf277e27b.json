{"ast":null,"code":"var path = require('path');\nvar once = require('once');\nvar concat = require('concat-stream');\nvar octal = require('octal');\nvar stat = require('./stat');\nvar xtend = require('xtend');\nvar errno = require('./errno');\nvar ROOT = stat({\n  type: 'directory',\n  mode: octal(777),\n  size: 4096\n});\nvar normalize = function (key) {\n  key = key[0] === '/' ? key : '/' + key;\n  key = path.normalize(key);\n  if (key === '/') return key;\n  return key[key.length - 1] === '/' ? key.slice(0, -1) : key;\n};\nvar prefix = function (key) {\n  var depth = key.split('/').length.toString(36);\n  return '0000000000'.slice(depth.length) + depth + key;\n};\nmodule.exports = function (db) {\n  var that = {};\n  that.normalize = normalize;\n  that.get = function (key, cb) {\n    key = normalize(key);\n    if (key === '/') return process.nextTick(cb.bind(null, null, ROOT, '/'));\n    db.get(prefix(key), {\n      valueEncoding: 'json'\n    }, function (err, doc) {\n      if (err && err.notFound) return cb(errno.ENOENT(key), null, key);\n      if (err) return cb(err, null, key);\n      cb(null, stat(doc), key);\n    });\n  };\n  that.writable = function (key, cb) {\n    key = normalize(key);\n    if (key === '/') return process.nextTick(cb.bind(null, errno.EPERM(key)));\n    that.follow(path.dirname(key), function (err, parent) {\n      if (err) return cb(err);\n      if (!parent.isDirectory()) return cb(errno.ENOTDIR(key));\n      cb(null, key);\n    });\n  };\n  that.list = function (key, cb) {\n    key = normalize(key);\n    var start = prefix(key === '/' ? key : key + '/');\n    var keys = db.createKeyStream({\n      start: start,\n      end: start + '\\xff'\n    });\n    cb = once(cb);\n    keys.on('error', cb);\n    keys.pipe(concat({\n      encoding: 'object'\n    }, function (files) {\n      files = files.map(function (file) {\n        return file.split('/').pop();\n      });\n      cb(null, files);\n    }));\n  };\n  var resolve = function (dir, cb) {\n    var root = '/';\n    var parts = dir.split('/').slice(1);\n    var loop = function () {\n      that.get(path.join(root, parts.shift()), function (err, doc, key) {\n        if (err) return cb(err, doc, dir);\n        root = doc.target || key;\n        if (!parts.length) return cb(null, doc, key);\n        loop();\n      });\n    };\n    loop();\n  };\n  that.follow = function (key, cb) {\n    resolve(normalize(key), function loop(err, doc, key) {\n      if (err) return cb(err, null, key);\n      if (doc.target) return that.get(doc.target, loop);\n      cb(null, stat(doc), key);\n    });\n  };\n  that.update = function (key, opts, cb) {\n    that.get(key, function (err, doc, key) {\n      if (err) return cb(err);\n      if (key === '/') return cb(errno.EPERM(key));\n      that.put(key, xtend(doc, opts), cb);\n    });\n  };\n  that.put = function (key, opts, cb) {\n    that.writable(key, function (err, key) {\n      if (err) return cb(err);\n      db.put(prefix(key), stat(opts), {\n        valueEncoding: 'json'\n      }, cb);\n    });\n  };\n  that.del = function (key, cb) {\n    key = normalize(key);\n    if (key === '/') return process.nextTick(cb.bind(null, errno.EPERM(key)));\n    db.del(prefix(key), cb);\n  };\n  return that;\n};","map":{"version":3,"names":["path","require","once","concat","octal","stat","xtend","errno","ROOT","type","mode","size","normalize","key","length","slice","prefix","depth","split","toString","module","exports","db","that","get","cb","process","nextTick","bind","valueEncoding","err","doc","notFound","ENOENT","writable","EPERM","follow","dirname","parent","isDirectory","ENOTDIR","list","start","keys","createKeyStream","end","on","pipe","encoding","files","map","file","pop","resolve","dir","root","parts","loop","join","shift","target","update","opts","put","del"],"sources":["C:/Users/Moran/Documents/react-projects/react-demo/node_modules/level-filesystem/paths.js"],"sourcesContent":["var path = require('path');\nvar once = require('once');\nvar concat = require('concat-stream');\nvar octal = require('octal')\nvar stat = require('./stat');\nvar xtend = require('xtend');\nvar errno = require('./errno');\n\nvar ROOT = stat({\n\ttype: 'directory',\n\tmode: octal(777),\n\tsize: 4096\n});\n\nvar normalize = function(key) {\n\tkey = key[0] === '/' ? key : '/' + key;\n\tkey = path.normalize(key);\n\tif (key === '/') return key;\n\treturn key[key.length-1] === '/' ? key.slice(0, -1) : key;\n};\n\nvar prefix = function(key) {\n\tvar depth = key.split('/').length.toString(36);\n\treturn '0000000000'.slice(depth.length)+depth+key;\n};\n\nmodule.exports = function(db) {\n\tvar that = {};\n\n\tthat.normalize = normalize;\n\n\tthat.get = function(key, cb) {\n\t\tkey = normalize(key);\n\t\tif (key === '/') return process.nextTick(cb.bind(null, null, ROOT, '/'));\n\t\tdb.get(prefix(key), {valueEncoding:'json'}, function(err, doc) {\n\t\t\tif (err && err.notFound) return cb(errno.ENOENT(key), null, key);\n\t\t\tif (err) return cb(err, null, key);\n\t\t\tcb(null, stat(doc), key);\n\t\t});\n\t};\n\n\tthat.writable = function(key, cb) {\n\t\tkey = normalize(key);\n\t\tif (key === '/') return process.nextTick(cb.bind(null, errno.EPERM(key)));\n\t\tthat.follow(path.dirname(key), function(err, parent) {\n\t\t\tif (err) return cb(err);\n\t\t\tif (!parent.isDirectory()) return cb(errno.ENOTDIR(key));\n\t\t\tcb(null, key);\n\t\t});\n\t};\n\n\tthat.list = function(key, cb) {\n\t\tkey = normalize(key);\n\n\t\tvar start = prefix(key === '/' ? key : key + '/');\n\t\tvar keys = db.createKeyStream({start: start, end: start+'\\xff'});\n\n\t\tcb = once(cb);\n\n\t\tkeys.on('error', cb);\n\t\tkeys.pipe(concat({encoding:'object'}, function(files) {\n\t\t\tfiles = files.map(function(file) {\n\t\t\t\treturn file.split('/').pop();\n\t\t\t});\n\n\t\t\tcb(null, files);\n\t\t}));\n\t};\n\n\tvar resolve = function(dir, cb) {\n\t\tvar root = '/';\n\t\tvar parts = dir.split('/').slice(1);\n\n\t\tvar loop = function() {\n\t\t\tthat.get(path.join(root, parts.shift()), function(err, doc, key) {\n\t\t\t\tif (err) return cb(err, doc, dir);\n\t\t\t\troot = doc.target || key;\n\t\t\t\tif (!parts.length) return cb(null, doc, key);\n\t\t\t\tloop();\n\t\t\t});\n\t\t};\n\n\t\tloop();\n\t};\n\n\tthat.follow = function(key, cb) {\n\t\tresolve(normalize(key), function loop(err, doc, key) {\n\t\t\tif (err) return cb(err, null, key);\n\t\t\tif (doc.target) return that.get(doc.target, loop);\n\t\t\tcb(null, stat(doc), key);\n\t\t});\n\t};\n\n\tthat.update = function(key, opts, cb) {\n\t\tthat.get(key, function(err, doc, key) {\n\t\t\tif (err) return cb(err);\n\t\t\tif (key === '/') return cb(errno.EPERM(key));\n\t\t\tthat.put(key, xtend(doc, opts), cb);\n\t\t});\n\t};\n\n\tthat.put = function(key, opts, cb) {\n\t\tthat.writable(key, function(err, key) {\n\t\t\tif (err) return cb(err);\n\t\t\tdb.put(prefix(key), stat(opts), {valueEncoding:'json'}, cb);\n\t\t});\n\t};\n\n\tthat.del = function(key, cb) {\n\t\tkey = normalize(key);\n\t\tif (key === '/') return process.nextTick(cb.bind(null, errno.EPERM(key)));\n\t\tdb.del(prefix(key), cb);\n\t};\n\n\treturn that;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}